---
title: "College Major Backgrounds and Effects"
author: "Dylan Holliday and Max Collins"
date: "May 7, 2025"
date-modified: now
format: 
  pdf:
    embed-resources: true
    number-sections: false
    toc: false
    fig-align: center
    cap-location: top
    link-external-newwindow: true
execute: 
  echo: false
  warning: false
---

# Research Topic: College Majors

Our Research is focused on finding trends and insights from post-secondary majors: how one's socioeconomic status plays a role in their major, as well as their major's effect on their income after graduation. This is a topic of interest for our team because we are in college and are thus interested in how different majors contain different groups of people and how the choice of a college major can affect one's future career. We will explore these relationships using a series of data visualizations and provide insights on income and diversity trends of recent college graduates. Our underlying purpose is to expose societal trends that may be hindering diversity initiatives in order to become a basis for possible change.

# Research Questions

Our first question we will explore is whether there is a significant difference in college race proportions compared to the national proportions. To do this, we intend to conduct a one sample proportion test comparing primarily the white proportion of college students to the national to expose a possible bias. 

# Provenance of Our Data

Our primary data source was found on Kaggle. Kaggle is a data science focused website that contains many data sets that learners can find and use. The author of this particular data set is Bojan Tunguz. The data is described as being from the American Community Survey 2010-2012 Public Use Microdata Series. The data set contains multiple data frames, but our study will focus upon the recent-grads data, which contains information on majors, earnings post-graduation, employment, employment type, major categories, and the amount of people in each major. Since these data are from a specific survey, they have not been updated and will not. The data, however, still maintains integrity following that all these majors still exist and no abnormal world events would lead us to deny insight from the data. Our analysis here will mainly focus on median salary, major categories (majors grouped within a similar field), unemployment rate, and total amount of graduates.  

Our secondary data source is from the 2022 American Community Survey, from the U.S. Census Bureau. This data contains information on popular majors and the percentage of each race and sex, as well as age and income categories. With all this said, our research with this data set will solely focus on the race proportions and poverty proportions. These data are not to be updated since they are also from a specific survey. Nevertheless, the data provides useful insights on socioeconomic background's role in college majors.

# FAIR and CARE Principles



# Analyses

```{r}
### Read in data and format to appropriate data frames

#1 Open Necessary Packages
library(tidyr)
library(readr)
library(dplyr)
library(rvest)
library(tidyverse)
library(ggplot2)
library(readxl)
library(janitor)
library(knitr)
library(kableExtra)

#2 Read in earnings data from url, diversity data from xlsx path

# Read in income data
recentGrads <- read_csv(
  # Separate string for visibility
  str_c("https://raw.githubusercontent.com/DJH6655",
        "/STAT184-Final-Project/refs/heads/main/recent-grads.csv"))

# Read in secondary data source
sexRaceFreqRaw <- read_excel("SexRaceFrequency.xlsx")


#3 Clean Excel Data, Selecting necessary attributes and renaming them
sexRaceFrequency <- sexRaceFreqRaw %>% 
  slice_head(n=41) %>% 
  slice_tail(n = 37) %>% 
  select(c(1,2,9,10,11,12,13,21,22)) %>% 
  rename(
    Major = 1,
    Total = 2,
    Race_White_Percent = 3, 
    Race_Black_Percent = 4,
    Race_Asian_Percent = 5,
    Race_Hispanic_Percent = 6,
    Race_OtherMulti_Percent = 7,
    Poverty_Percent = 8,
    Not_Poverty_Percent = 9
  ) %>% 
  filter(!is.na(Total)) %>% 
  slice(c(-14,-20,-23)) %>% 
  mutate(Major = toupper(Major),
         Total = as.numeric(Total),
         Race_White_Percent = as.numeric(Race_White_Percent),
         Race_Black_Percent = as.numeric(Race_Black_Percent),
         Race_Asian_Percent = as.numeric(Race_Asian_Percent),
         Race_Hispanic_Percent = as.numeric(Race_Hispanic_Percent),
         Race_OtherMulti_Percent = as.numeric(Race_OtherMulti_Percent),
         Poverty_Percent = as.numeric(Poverty_Percent),
         Not_Poverty_Percent = as.numeric(Not_Poverty_Percent)
         )

# Count Table
sexRaceCount <- sexRaceFrequency %>%
  mutate(
    Race_White_Count = floor((Race_White_Percent / 100)*Total),
    Race_Black_Count = floor((Race_Black_Percent / 100)*Total),
    Race_Asian_Count = floor((Race_Asian_Percent / 100)*Total),
    Race_Hispanic_Count = floor((Race_Hispanic_Percent / 100)*Total),
    Race_OtherMulti_Count = floor((Race_OtherMulti_Percent / 100)*Total),
    Poverty_Count = floor((Poverty_Percent / 100)*Total),
    Not_Poverty_Count = floor((Not_Poverty_Percent / 100)*Total)
  )

# Join our two dataframes together
joinedTables <-
  inner_join(
    sexRaceCount,
    recentGrads,
    by = join_by(Major == Major)
  ) 

# Make a Summary Table
majorCategories <- joinedTables %>% 
  group_by(Major_category) %>%
  summarize(
    "Count" = sum(Total.x),
    "Average First Quartile" = mean(P25th),
    "Average Median Salary" = mean(Median),
    "Average Third Quartile" = mean(P75th),
    "Average Unemployment Rate" = mean(Unemployment_rate),
    "White" = floor(mean(Race_White_Count)),
    "Black" = floor(mean(Race_Black_Count)),
    "Asian" = floor(mean(Race_Asian_Count)),
    "Hispanic" = floor(mean(Race_Hispanic_Count)),
    "Other" = floor(mean(Race_OtherMulti_Count)),
    "Poverty Count" = floor(mean(Poverty_Count))
  )



```

## An Analysis of Race Frequency among Major Categories

This analysis will try to determine if there is a statistically significant bias towards people of white ethnicity in a college setting by comparing the collegiate white race percentage with the national white race percentage. We will be conducting a One Sample Proportion Z-Test to make our conclusion.

**Hypotheses**:  

  $H_0$ : $p = p_0$ There is no significant difference in the white collegiate race proportion and national (population) white race proportion.  
  $H_a$ : $p \ne p_0$ There exists a significant difference in the proportion of white people between college students and the national (population).  
  
To start, we must find the proportion of white college students. The proportion lies in the table below.

Below is a table depicting the percent frequency of each race in each major category as a portion of the sample population.

```{r}
### Make a Race/Major Category frequency table

#1 Select Necessary attributes and pivot longer
freqTablePrep <- majorCategories %>%
  select(1,7,8,9,10,11) %>%
  pivot_longer(!Major_category, names_to = "Race", values_to = "Count")
  
#2 Use uncount to have a case be one individual
byStudent <- uncount(freqTablePrep, Count)

#3 Formats frequency table and relative frequencies
raceFreq <- byStudent %>% 
  tabyl(Major_category, Race) %>%
  adorn_totals(where = "col") %>%
  arrange(desc(Total)) %>%
  adorn_totals(where = "row") %>%
  adorn_percentages(denominator = "all") %>%
  adorn_pct_formatting(digits = 2) %>%
  adorn_title(
    placement = "combined",
    row_name = "Major Category",
    col_name = "Race"
  )

#4 Outputs a stylized table
raceFreq %>%
  kable(
    caption = "Frequency of Each Major Category Based on Race",
    booktabs = TRUE,
    align = "lrrrrrr"
  ) 
```

As one can tell, there is a clear disparity between the proportion of white students and the proportion of students of different races, with the total percentage of white college students being 64.14%. Since we do not yet have the population proportion, no assumptions relating to our hypotheses can be made. 

Another noteworthy finding is that 20.46% of Asian students have a major in the Computers and Mathematics Category, as opposed to just 8.13% of the whole collegiate population. This percentage can be obtained by taking the 2.38% of Asians in Computers & Mathematics and divide by the 11.63% of total Asian students in the collegiate population. This statistic tells us that Asians are more likely to have a major in Computers and Mathematics than the college population as a whole. Even still, everyone should avoid stereotyping so that all people have free choice to study whatever they choose.  

Back to our analysis, the college proportion of white students is 64.14%. Let's call this $p_0$. According to the US Census, 63.44% of the total United States population identifies as white. Let's call this $p$. According to the One Sample Proportion Z-Test:  
  
  $$z = \frac{p-p_0}{\sqrt{p_0(1-p_0)/n}}$$  
  
Where $p_0$ is the white college students proportion, $p$ is the total white US population proportion, and $n$ is the total number of college students in the sample:  
 `r sum(majorCategories['Count'])`
 
As such, our z value is calculated to be:

$$ z = -84.73 $$
Since our z value is so large (in absolute value), our p-value is most nearly 0, leading us to reject our null hypothesis. This leads us to believe there is a statistical difference in the proportion of white college students and the proportion of the US Population that is white. There are faults with this analysis, however; since the college data came from the US Census as well, such a large "sample" size would indicate a difference in the smallest of proportions. Therefore, Any insights to be made from this test are rendered insignificant. Conducting tests on a smaller scale (such as a school by school basis) will help individual school leaders find if their school is meeting diversity standards.

``` {r}
## Creates a sideways bar chart

#1 Select data frame to make graph from and pick which variables correspond to each axis
ggplot(majorCategories) +
  aes(
    x = `Average Median Salary`,
    y = Major_category,
    fill = Major_category #gives each a different color
  ) + # creates bar graph
  geom_bar(stat = "summary", fun = "sum") +
  labs(#adds axis titles and graph title
    x = "Average Median Salary",
    y = "Major Category",
    title = "Average Median Salary by Major Category"
  )+
  theme_minimal()+
  theme(#eliminates unneccesary space from legend
    legend.position = "none",
    plot.title.position = "plot"
  )
```

``` {r}
ggplot(majorCategories, aes(y = Major_category))+
  geom_boxplot(
    aes(
      xmin = `Average First Quartile`,
      xlower = `Average First Quartile`,
      xmiddle = `Average Median Salary`,
      xupper = `Average Third Quartile`,
      xmax = `Average Third Quartile`,
      fill = Major_category
    ),
    stat = "identity"
  )+
  labs(
    x = "Salary",
    y = "Major Category",
    title = "Salary Distribution by Major Category"
  )+ theme_minimal()+
  theme(
    plot.title.position = "plot",
    legend.position = "none"
  )
```

``` {r}

##Creates dot plot that shows the number of graduates from each category by race

#1 Select race attributes and pivot longer to get totals

dotPlot <- majorCategories %>%
  select(1,7,8,9,10,11) %>%
  pivot_longer(!Major_category, names_to = "Race", values_to = "Count")

#2 Creates dot plot of total gradutes by category and race

ggplot(dotPlot)+
  aes(
    x = Count,
    y = Major_category,
    color = Race#makes each race a different color
  )+
  geom_point(size = 2)+#increased size to enahce readability
  labs(
    x = "Count",
    y = "Major Category",
    title = "Total College Graduates by Major Category and Race"
  )+
  theme_minimal()+
  theme(
    plot.title.position = "plot"
  )
```
``` {r}
##Creates dot plot to show the percentages of colege graduates from each race for each major category

#1 Wrangle data to create percentage column that shows percent for each category
dotPlotPct <- dotPlot %>% 
  group_by(Race) %>% 
  mutate (Pct = Count / sum(Count))

#2 Creats dot plot of percent of total gradute from each race per major category

ggplot(dotPlotPct)+
  aes(
    x = Pct,
    y = Major_category,
    color = Race
  )+
  geom_point(size = 2)+
  labs(
    x = "Percent of Each Race",
    y = "Major Category",
    title = "Percent of College Graduates of Each Race by Major Category"
  )+
  theme_minimal()+
  theme(
    plot.title.position = "plot"
  )
```
``` {r}
## Creates dot plot that shows the percent of college graduates from each major category that are in poverty

#1 Creates dot plot
ggplot(majorCategories) +
  aes(
    x = `Poverty Count` / Count, #equation that generates percentage
    y = Major_category,
    color = Major_category
  ) +
  geom_point(size = 3) +
  labs(
    x = "Percentage in Poverty",
    y = "Major Category",
    title = "Percentage of College Graduates in Poverty by Major Category"
  )+
  theme_minimal()+
  theme(
    plot.title.position = "plot",
    legend.position = "none"
  )
```
```{r}
#Creates dot plot 
ggplot(majorCategories) +
  aes(
    x = `Poverty Count` / Count,
    y = `Average Median Salary`,
    colour = Major_category
  ) +
  geom_point(size = 3) +
  labs(
    x = "Percentage in Poverty",
    y = "Average Median Salary",
    color = "Major Category",
    title = "Total College Graduates in Poverty by Major Category"
  )+
  theme_minimal()+
  theme(
    plot.title.position = "plot"
)
```

# Conclusions

# References
https://www.neilsberg.com/insights/united-states-population-by-race/#:~:text=The%20percent%20distribution%20of%20United%20States%20population%20by,are%20some%20other%20race%20and%2010.71%25%20are%20multiracial.

```{r codeAppend, ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}
```
